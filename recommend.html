<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />
<meta name="viewport" content="width=device-width, initial-scale=1">

<style type="text/css">
@font-face {
font-family: octicons-link;
src: url(data:font/woff;charset=utf-8;base64,d09GRgABAAAAAAZwABAAAAAACFQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABEU0lHAAAGaAAAAAgAAAAIAAAAAUdTVUIAAAZcAAAACgAAAAoAAQAAT1MvMgAAAyQAAABJAAAAYFYEU3RjbWFwAAADcAAAAEUAAACAAJThvmN2dCAAAATkAAAABAAAAAQAAAAAZnBnbQAAA7gAAACyAAABCUM+8IhnYXNwAAAGTAAAABAAAAAQABoAI2dseWYAAAFsAAABPAAAAZwcEq9taGVhZAAAAsgAAAA0AAAANgh4a91oaGVhAAADCAAAABoAAAAkCA8DRGhtdHgAAAL8AAAADAAAAAwGAACfbG9jYQAAAsAAAAAIAAAACABiATBtYXhwAAACqAAAABgAAAAgAA8ASm5hbWUAAAToAAABQgAAAlXu73sOcG9zdAAABiwAAAAeAAAAME3QpOBwcmVwAAAEbAAAAHYAAAB/aFGpk3jaTY6xa8JAGMW/O62BDi0tJLYQincXEypYIiGJjSgHniQ6umTsUEyLm5BV6NDBP8Tpts6F0v+k/0an2i+itHDw3v2+9+DBKTzsJNnWJNTgHEy4BgG3EMI9DCEDOGEXzDADU5hBKMIgNPZqoD3SilVaXZCER3/I7AtxEJLtzzuZfI+VVkprxTlXShWKb3TBecG11rwoNlmmn1P2WYcJczl32etSpKnziC7lQyWe1smVPy/Lt7Kc+0vWY/gAgIIEqAN9we0pwKXreiMasxvabDQMM4riO+qxM2ogwDGOZTXxwxDiycQIcoYFBLj5K3EIaSctAq2kTYiw+ymhce7vwM9jSqO8JyVd5RH9gyTt2+J/yUmYlIR0s04n6+7Vm1ozezUeLEaUjhaDSuXHwVRgvLJn1tQ7xiuVv/ocTRF42mNgZGBgYGbwZOBiAAFGJBIMAAizAFoAAABiAGIAznjaY2BkYGAA4in8zwXi+W2+MjCzMIDApSwvXzC97Z4Ig8N/BxYGZgcgl52BCSQKAA3jCV8CAABfAAAAAAQAAEB42mNgZGBg4f3vACQZQABIMjKgAmYAKEgBXgAAeNpjYGY6wTiBgZWBg2kmUxoDA4MPhGZMYzBi1AHygVLYQUCaawqDA4PChxhmh/8ODDEsvAwHgMKMIDnGL0x7gJQCAwMAJd4MFwAAAHjaY2BgYGaA4DAGRgYQkAHyGMF8NgYrIM3JIAGVYYDT+AEjAwuDFpBmA9KMDEwMCh9i/v8H8sH0/4dQc1iAmAkALaUKLgAAAHjaTY9LDsIgEIbtgqHUPpDi3gPoBVyRTmTddOmqTXThEXqrob2gQ1FjwpDvfwCBdmdXC5AVKFu3e5MfNFJ29KTQT48Ob9/lqYwOGZxeUelN2U2R6+cArgtCJpauW7UQBqnFkUsjAY/kOU1cP+DAgvxwn1chZDwUbd6CFimGXwzwF6tPbFIcjEl+vvmM/byA48e6tWrKArm4ZJlCbdsrxksL1AwWn/yBSJKpYbq8AXaaTb8AAHja28jAwOC00ZrBeQNDQOWO//sdBBgYGRiYWYAEELEwMTE4uzo5Zzo5b2BxdnFOcALxNjA6b2ByTswC8jYwg0VlNuoCTWAMqNzMzsoK1rEhNqByEyerg5PMJlYuVueETKcd/89uBpnpvIEVomeHLoMsAAe1Id4AAAAAAAB42oWQT07CQBTGv0JBhagk7HQzKxca2sJCE1hDt4QF+9JOS0nbaaYDCQfwCJ7Au3AHj+LO13FMmm6cl7785vven0kBjHCBhfpYuNa5Ph1c0e2Xu3jEvWG7UdPDLZ4N92nOm+EBXuAbHmIMSRMs+4aUEd4Nd3CHD8NdvOLTsA2GL8M9PODbcL+hD7C1xoaHeLJSEao0FEW14ckxC+TU8TxvsY6X0eLPmRhry2WVioLpkrbp84LLQPGI7c6sOiUzpWIWS5GzlSgUzzLBSikOPFTOXqly7rqx0Z1Q5BAIoZBSFihQYQOOBEdkCOgXTOHA07HAGjGWiIjaPZNW13/+lm6S9FT7rLHFJ6fQbkATOG1j2OFMucKJJsxIVfQORl+9Jyda6Sl1dUYhSCm1dyClfoeDve4qMYdLEbfqHf3O/AdDumsjAAB42mNgYoAAZQYjBmyAGYQZmdhL8zLdDEydARfoAqIAAAABAAMABwAKABMAB///AA8AAQAAAAAAAAAAAAAAAAABAAAAAA==) format('woff');
}
body {
-webkit-text-size-adjust: 100%;
text-size-adjust: 100%;
color: #333;
font-family: "Helvetica Neue", Helvetica, "Segoe UI", Arial, freesans, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
font-size: 16px;
line-height: 1.6;
word-wrap: break-word;
}
a {
background-color: transparent;
}
a:active,
a:hover {
outline: 0;
}
strong {
font-weight: bold;
}
h1 {
font-size: 2em;
margin: 0.67em 0;
}
img {
border: 0;
}
hr {
box-sizing: content-box;
height: 0;
}
pre {
overflow: auto;
}
code,
kbd,
pre {
font-family: monospace, monospace;
font-size: 1em;
}
input {
color: inherit;
font: inherit;
margin: 0;
}
html input[disabled] {
cursor: default;
}
input {
line-height: normal;
}
input[type="checkbox"] {
box-sizing: border-box;
padding: 0;
}
table {
border-collapse: collapse;
border-spacing: 0;
}
td,
th {
padding: 0;
}
* {
box-sizing: border-box;
}
input {
font: 13px / 1.4 Helvetica, arial, nimbussansl, liberationsans, freesans, clean, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
}
a {
color: #4078c0;
text-decoration: none;
}
a:hover,
a:active {
text-decoration: underline;
}
hr {
height: 0;
margin: 15px 0;
overflow: hidden;
background: transparent;
border: 0;
border-bottom: 1px solid #ddd;
}
hr:before {
display: table;
content: "";
}
hr:after {
display: table;
clear: both;
content: "";
}
h1,
h2,
h3,
h4,
h5,
h6 {
margin-top: 15px;
margin-bottom: 15px;
line-height: 1.1;
}
h1 {
font-size: 30px;
}
h2 {
font-size: 21px;
}
h3 {
font-size: 16px;
}
h4 {
font-size: 14px;
}
h5 {
font-size: 12px;
}
h6 {
font-size: 11px;
}
blockquote {
margin: 0;
}
ul,
ol {
padding: 0;
margin-top: 0;
margin-bottom: 0;
}
ol ol,
ul ol {
list-style-type: lower-roman;
}
ul ul ol,
ul ol ol,
ol ul ol,
ol ol ol {
list-style-type: lower-alpha;
}
dd {
margin-left: 0;
}
code {
font-family: Consolas, "Liberation Mono", Menlo, Courier, monospace;
font-size: 12px;
}
pre {
margin-top: 0;
margin-bottom: 0;
font: 12px Consolas, "Liberation Mono", Menlo, Courier, monospace;
}
.select::-ms-expand {
opacity: 0;
}
.octicon {
font: normal normal normal 16px/1 octicons-link;
display: inline-block;
text-decoration: none;
text-rendering: auto;
-webkit-font-smoothing: antialiased;
-moz-osx-font-smoothing: grayscale;
-webkit-user-select: none;
-moz-user-select: none;
-ms-user-select: none;
user-select: none;
}
.octicon-link:before {
content: '\f05c';
}
.markdown-body:before {
display: table;
content: "";
}
.markdown-body:after {
display: table;
clear: both;
content: "";
}
.markdown-body>*:first-child {
margin-top: 0 !important;
}
.markdown-body>*:last-child {
margin-bottom: 0 !important;
}
a:not([href]) {
color: inherit;
text-decoration: none;
}
.anchor {
display: inline-block;
padding-right: 2px;
margin-left: -18px;
}
.anchor:focus {
outline: none;
}
h1,
h2,
h3,
h4,
h5,
h6 {
margin-top: 1em;
margin-bottom: 16px;
font-weight: bold;
line-height: 1.4;
}
h1 .octicon-link,
h2 .octicon-link,
h3 .octicon-link,
h4 .octicon-link,
h5 .octicon-link,
h6 .octicon-link {
color: #000;
vertical-align: middle;
visibility: hidden;
}
h1:hover .anchor,
h2:hover .anchor,
h3:hover .anchor,
h4:hover .anchor,
h5:hover .anchor,
h6:hover .anchor {
text-decoration: none;
}
h1:hover .anchor .octicon-link,
h2:hover .anchor .octicon-link,
h3:hover .anchor .octicon-link,
h4:hover .anchor .octicon-link,
h5:hover .anchor .octicon-link,
h6:hover .anchor .octicon-link {
visibility: visible;
}
h1 {
padding-bottom: 0.3em;
font-size: 2.25em;
line-height: 1.2;
border-bottom: 1px solid #eee;
}
h1 .anchor {
line-height: 1;
}
h2 {
padding-bottom: 0.3em;
font-size: 1.75em;
line-height: 1.225;
border-bottom: 1px solid #eee;
}
h2 .anchor {
line-height: 1;
}
h3 {
font-size: 1.5em;
line-height: 1.43;
}
h3 .anchor {
line-height: 1.2;
}
h4 {
font-size: 1.25em;
}
h4 .anchor {
line-height: 1.2;
}
h5 {
font-size: 1em;
}
h5 .anchor {
line-height: 1.1;
}
h6 {
font-size: 1em;
color: #777;
}
h6 .anchor {
line-height: 1.1;
}
p,
blockquote,
ul,
ol,
dl,
table,
pre {
margin-top: 0;
margin-bottom: 16px;
}
hr {
height: 4px;
padding: 0;
margin: 16px 0;
background-color: #e7e7e7;
border: 0 none;
}
ul,
ol {
padding-left: 2em;
}
ul ul,
ul ol,
ol ol,
ol ul {
margin-top: 0;
margin-bottom: 0;
}
li>p {
margin-top: 16px;
}
dl {
padding: 0;
}
dl dt {
padding: 0;
margin-top: 16px;
font-size: 1em;
font-style: italic;
font-weight: bold;
}
dl dd {
padding: 0 16px;
margin-bottom: 16px;
}
blockquote {
padding: 0 15px;
color: #777;
border-left: 4px solid #ddd;
}
blockquote>:first-child {
margin-top: 0;
}
blockquote>:last-child {
margin-bottom: 0;
}
table {
display: block;
width: 100%;
overflow: auto;
word-break: normal;
word-break: keep-all;
}
table th {
font-weight: bold;
}
table th,
table td {
padding: 6px 13px;
border: 1px solid #ddd;
}
table tr {
background-color: #fff;
border-top: 1px solid #ccc;
}
table tr:nth-child(2n) {
background-color: #f8f8f8;
}
img {
max-width: 100%;
box-sizing: content-box;
background-color: #fff;
}
code {
padding: 0;
padding-top: 0.2em;
padding-bottom: 0.2em;
margin: 0;
font-size: 85%;
background-color: rgba(0,0,0,0.04);
border-radius: 3px;
}
code:before,
code:after {
letter-spacing: -0.2em;
content: "\00a0";
}
pre>code {
padding: 0;
margin: 0;
font-size: 100%;
word-break: normal;
white-space: pre;
background: transparent;
border: 0;
}
.highlight {
margin-bottom: 16px;
}
.highlight pre,
pre {
padding: 16px;
overflow: auto;
font-size: 85%;
line-height: 1.45;
background-color: #f7f7f7;
border-radius: 3px;
}
.highlight pre {
margin-bottom: 0;
word-break: normal;
}
pre {
word-wrap: normal;
}
pre code {
display: inline;
max-width: initial;
padding: 0;
margin: 0;
overflow: initial;
line-height: inherit;
word-wrap: normal;
background-color: transparent;
border: 0;
}
pre code:before,
pre code:after {
content: normal;
}
kbd {
display: inline-block;
padding: 3px 5px;
font-size: 11px;
line-height: 10px;
color: #555;
vertical-align: middle;
background-color: #fcfcfc;
border: solid 1px #ccc;
border-bottom-color: #bbb;
border-radius: 3px;
box-shadow: inset 0 -1px 0 #bbb;
}
.pl-c {
color: #969896;
}
.pl-c1,
.pl-s .pl-v {
color: #0086b3;
}
.pl-e,
.pl-en {
color: #795da3;
}
.pl-s .pl-s1,
.pl-smi {
color: #333;
}
.pl-ent {
color: #63a35c;
}
.pl-k {
color: #a71d5d;
}
.pl-pds,
.pl-s,
.pl-s .pl-pse .pl-s1,
.pl-sr,
.pl-sr .pl-cce,
.pl-sr .pl-sra,
.pl-sr .pl-sre {
color: #183691;
}
.pl-v {
color: #ed6a43;
}
.pl-id {
color: #b52a1d;
}
.pl-ii {
background-color: #b52a1d;
color: #f8f8f8;
}
.pl-sr .pl-cce {
color: #63a35c;
font-weight: bold;
}
.pl-ml {
color: #693a17;
}
.pl-mh,
.pl-mh .pl-en,
.pl-ms {
color: #1d3e81;
font-weight: bold;
}
.pl-mq {
color: #008080;
}
.pl-mi {
color: #333;
font-style: italic;
}
.pl-mb {
color: #333;
font-weight: bold;
}
.pl-md {
background-color: #ffecec;
color: #bd2c00;
}
.pl-mi1 {
background-color: #eaffea;
color: #55a532;
}
.pl-mdr {
color: #795da3;
font-weight: bold;
}
.pl-mo {
color: #1d3e81;
}
kbd {
display: inline-block;
padding: 3px 5px;
font: 11px Consolas, "Liberation Mono", Menlo, Courier, monospace;
line-height: 10px;
color: #555;
vertical-align: middle;
background-color: #fcfcfc;
border: solid 1px #ccc;
border-bottom-color: #bbb;
border-radius: 3px;
box-shadow: inset 0 -1px 0 #bbb;
}
.task-list-item {
list-style-type: none;
}
.task-list-item+.task-list-item {
margin-top: 3px;
}
.task-list-item input {
margin: 0 0.35em 0.25em -1.6em;
vertical-align: middle;
}
:checked+.radio-label {
z-index: 1;
position: relative;
border-color: #4078c0;
}
.sourceLine {
display: inline-block;
}
code .kw { color: #000000; }
code .dt { color: #ed6a43; }
code .dv { color: #009999; }
code .bn { color: #009999; }
code .fl { color: #009999; }
code .ch { color: #009999; }
code .st { color: #183691; }
code .co { color: #969896; }
code .ot { color: #0086b3; }
code .al { color: #a61717; }
code .fu { color: #63a35c; }
code .er { color: #a61717; background-color: #e3d2d2; }
code .wa { color: #000000; }
code .cn { color: #008080; }
code .sc { color: #008080; }
code .vs { color: #183691; }
code .ss { color: #183691; }
code .im { color: #000000; }
code .va {color: #008080; }
code .cf { color: #000000; }
code .op { color: #000000; }
code .bu { color: #000000; }
code .ex { color: #000000; }
code .pp { color: #999999; }
code .at { color: #008080; }
code .do { color: #969896; }
code .an { color: #008080; }
code .cv { color: #008080; }
code .in { color: #008080; }
</style>
<style>
body {
  box-sizing: border-box;
  min-width: 200px;
  max-width: 980px;
  margin: 0 auto;
  padding: 45px;
  padding-top: 0px;
}
</style>

</head>

<body>

<h1 id="recommend">Recommend</h1>
<p>Marthinus Basson 8/22/2018</p>
<h2 id="r-markdown">R Markdown</h2>
<p>Problem: Given a database of books and the ratings by users of books they have read, create a recommendation of 10 books to a new or existing user. The recommendation should be based on item-based collabrative filtering and user based colabrative filtering.</p>
<p>Load the required packages and the database retaining the user info and book info. Recommender package contain the functions used fot collabrative filtering.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw">library</span>(tidyverse)</a></code></pre></div>
<pre><code>## ── Attaching packages ─────────────────────────────────────────────────────────────────────────────── tidyverse 1.2.1 ──

## ✔ ggplot2 2.2.1     ✔ purrr   0.2.4
## ✔ tibble  1.4.2     ✔ dplyr   0.7.4
## ✔ tidyr   0.8.0     ✔ stringr 1.2.0
## ✔ readr   1.1.1     ✔ forcats 0.2.0

## ── Conflicts ────────────────────────────────────────────────────────────────────────────────── tidyverse_conflicts() ──
## ✖ dplyr::filter() masks stats::filter()
## ✖ dplyr::lag()    masks stats::lag()
</code></pre>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="kw">library</span>(digest)</a>
<a class="sourceLine" id="cb3-2" data-line-number="2"><span class="kw">library</span>(Recommender)</a>
<a class="sourceLine" id="cb3-3" data-line-number="3"><span class="kw">library</span>(NNLM)</a></code></pre></div>
<pre><code>## Warning: package 'NNLM' was built under R version 3.4.4
</code></pre>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1"><span class="kw">load</span>(<span class="st">&quot;book_ratings.Rdata&quot;</span>)</a></code></pre></div>
<p>###Item-based colabrartive filtering###</p>
<p>First we need to create a matrix of the ratings by each user. There is duplicate entries for some books in the database of book information, so first the duplicates needs to removed. Then a the data table of book info and user info are joined together. Then a matrix is created with all the ratings from users againts each book read. The ratings are changed with 1 if it has a rating or a 0 if the user has not read the book. The user id column is removed from the matrix to have it only contain the ratings.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1">book_info&lt;-book_info[<span class="op">!</span><span class="kw">duplicated</span>(book_info<span class="op">$</span>Book.Title),] <span class="co">#remove duplicates</span></a>
<a class="sourceLine" id="cb6-2" data-line-number="2">ratings_user&lt;-<span class="kw">inner_join</span>(book_info,book_ratings) <span class="co">#create database of user ratings and book information</span></a></code></pre></div>
<pre><code>## Joining, by = &quot;ISBN&quot;
</code></pre>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1"> <span class="co">#create matrix of movie ratings per user</span></a>
<a class="sourceLine" id="cb8-2" data-line-number="2">read_book &lt;-<span class="st"> </span>ratings_user <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb8-3" data-line-number="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">seen =</span> <span class="kw">ifelse</span>(<span class="op">!</span><span class="kw">is.na</span>(Book.Rating),<span class="dv">1</span>,<span class="dv">0</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb8-4" data-line-number="4"><span class="st">  </span><span class="kw">select</span>(User.ID, Book.Title, seen)<span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb8-5" data-line-number="5"><span class="st">  </span><span class="kw">spread</span>(<span class="dt">key =</span> Book.Title, <span class="dt">value =</span> seen)</a>
<a class="sourceLine" id="cb8-6" data-line-number="6">read_book&lt;-<span class="st"> </span>read_book  <span class="op">%&gt;%</span><span class="st">  </span><span class="kw">mutate_all</span>(<span class="kw">funs</span>(<span class="kw">replace</span>(.,<span class="kw">is.na</span>(.),<span class="dv">0</span>))) <span class="co">#replac NA's with 0</span></a>
<a class="sourceLine" id="cb8-7" data-line-number="7">sorted_my_users &lt;-<span class="st"> </span><span class="kw">as.character</span>(<span class="kw">unlist</span>(read_book[,<span class="dv">1</span>]))</a>
<a class="sourceLine" id="cb8-8" data-line-number="8">read_books&lt;-<span class="st"> </span><span class="kw">as.matrix</span>(read_book[,<span class="op">!</span>(<span class="kw">names</span>(read_book) <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;User.ID&quot;</span>))])</a></code></pre></div>
<p>The follwing will recommend a list of movies according to the exisitng user based on item based recommendation. The item recommdation was done by creating a empty matrix the same size as the user matrix. The similarity score is calcaulted between the user and the book rating matrix using the cosine equation. The resulting matrix contains the score bewteen each book and how similar it is to the chosen user in its diagonal row. These values are extracted and the resulting score are ranked in descending order. The top 10 books, which the user has not read, are then displayed.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1"><span class="co"># get item similarity for certain user</span></a>
<a class="sourceLine" id="cb9-2" data-line-number="2"></a>
<a class="sourceLine" id="cb9-3" data-line-number="3"><span class="kw">recommend</span>(read_books,<span class="dv">13</span>,<span class="dt">type =</span> <span class="st">'item'</span>)</a></code></pre></div>
<pre><code>##                                                               title
## 1           the perfect storm : a true story of men against the sea
## 2                                                    kiss the girls
## 3                                         the lovely bones: a novel
## 4                                                      the brethren
## 5                                                     the testament
## 6                                            the kitchen god's wife
## 7                                                  while i was gone
## 8  harry potter and the sorcerer's stone (harry potter (paperback))
## 9                                           the secret life of bees
## 10                                                      good in bed
##         score
## 1  0.05394706
## 2  0.04790039
## 3  0.04717541
## 4  0.04710842
## 5  0.04605263
## 6  0.04401268
## 7  0.04330127
## 8  0.04319772
## 9  0.04131119
## 10 0.04124844
</code></pre>
<p>This is to calculate for a new user. First the new user is added to the database and the recommendation is calculated for new user.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1">new_user &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">User.ID =</span><span class="dv">300000</span>, <span class="dt">ISBN=</span> <span class="kw">c</span>(<span class="st">&quot;0440234743&quot;</span>, <span class="st">&quot;0971880107&quot;</span>, <span class="st">&quot;0345417623&quot;</span>), <span class="dt">Book.Rating =</span> <span class="kw">as.integer</span>(<span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">5</span>, <span class="dv">3</span>)))</a>
<a class="sourceLine" id="cb11-2" data-line-number="2"></a>
<a class="sourceLine" id="cb11-3" data-line-number="3">new_book_ratings&lt;-<span class="kw">inner_join</span>(new_user,book_info)</a></code></pre></div>
<pre><code>## Joining, by = &quot;ISBN&quot;

## Warning: Column `ISBN` joining factor and character vector, coercing into
## character vector
</code></pre>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" data-line-number="1">new_ratings_user&lt;-<span class="kw">rbind</span>(new_book_ratings,ratings_user)</a>
<a class="sourceLine" id="cb13-2" data-line-number="2"></a>
<a class="sourceLine" id="cb13-3" data-line-number="3">new_read_book &lt;-<span class="st"> </span>new_ratings_user <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb13-4" data-line-number="4"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">seen =</span> <span class="kw">ifelse</span>(<span class="op">!</span><span class="kw">is.na</span>(Book.Rating),<span class="dv">1</span>,<span class="dv">0</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb13-5" data-line-number="5"><span class="st">  </span><span class="kw">select</span>(User.ID, Book.Title, seen)<span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb13-6" data-line-number="6"><span class="st">  </span><span class="kw">spread</span>(<span class="dt">key =</span> Book.Title, <span class="dt">value =</span> seen)</a>
<a class="sourceLine" id="cb13-7" data-line-number="7">new_read_book&lt;-<span class="st"> </span>new_read_book  <span class="op">%&gt;%</span><span class="st">  </span><span class="kw">mutate_all</span>(<span class="kw">funs</span>(<span class="kw">replace</span>(.,<span class="kw">is.na</span>(.),<span class="dv">0</span>))) <span class="co">#replac NA's with 0</span></a>
<a class="sourceLine" id="cb13-8" data-line-number="8">new_sorted_my_users &lt;-<span class="st"> </span><span class="kw">as.character</span>(<span class="kw">unlist</span>(new_read_book[,<span class="dv">1</span>]))</a>
<a class="sourceLine" id="cb13-9" data-line-number="9">new_read_books&lt;-<span class="st"> </span><span class="kw">as.matrix</span>(new_read_book[,<span class="op">!</span>(<span class="kw">names</span>(new_read_book) <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;User.ID&quot;</span>))])</a>
<a class="sourceLine" id="cb13-10" data-line-number="10"></a>
<a class="sourceLine" id="cb13-11" data-line-number="11"><span class="kw">recommend</span>(new_read_books,<span class="dv">149</span>,<span class="dt">type=</span><span class="st">'item'</span>)</a></code></pre></div>
<pre><code>##                                              title      score
## 1                                      wild animus 0.14470109
## 2                        the lovely bones: a novel 0.12459887
## 3                       interview with the vampire 0.10859807
## 4                                the da vinci code 0.10715324
## 5                              angels &amp;amp; demons 0.10223104
## 6                                         the firm 0.09397618
## 7  divine secrets of the ya-ya sisterhood: a novel 0.09105593
## 8                                the joy luck club 0.08946481
## 9                    the poisonwood bible: a novel 0.08872961
## 10                           house of sand and fog 0.08862601
</code></pre>
<p>The follwing function will return an approximate list of recommended books for selected user, using user based [This is not completely correct list of recommendations, but with some work it can produce the correct list]. The recommender is based on the item recommender system. It extracts the top books that are similar to that of the chosen user, and then recommends the books those users have read and removes that books that have been read by chosen user.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" data-line-number="1"><span class="co"># get user similarity for certain user</span></a>
<a class="sourceLine" id="cb15-2" data-line-number="2"><span class="kw">recommend</span>(read_books,<span class="dv">13</span>,<span class="dt">type =</span> <span class="st">'user'</span>,<span class="dt">raw_data =</span> read_book)</a></code></pre></div>
<pre><code>##  [1] &quot;the book of ruth (oprah's book club (paperback))&quot;          
##  [2] &quot;wild animus&quot;                                               
##  [3] &quot;bridget jones's diary&quot;                                     
##  [4] &quot;the nanny diaries: a novel&quot;                                
##  [5] &quot;the catcher in the rye&quot;                                    
##  [6] &quot;the queen of the damned (vampire chronicles (paperback))&quot;  
##  [7] &quot;harry potter and the chamber of secrets (book 2)&quot;          
##  [8] &quot;the bad beginning (a series of unfortunate events, book 1)&quot;
##  [9] &quot;bel canto: a novel&quot;                                        
## [10] &quot;the lovely bones: a novel&quot;
</code></pre>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" data-line-number="1"><span class="co">#raw_data is a data table without the user id removes to cross reference the books against the users.</span></a></code></pre></div>
<p>This function is just a different way of using item based recommendation just for interest sake.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" data-line-number="1"><span class="co"># get item similarity for certain user</span></a>
<a class="sourceLine" id="cb18-2" data-line-number="2"><span class="kw">recommend</span>(read_books,<span class="dv">13</span>,<span class="dt">type =</span> <span class="st">'item2'</span>)</a></code></pre></div>
<pre><code>##  [1] &quot;the lovely bones: a novel&quot;                      
##  [2] &quot;the da vinci code&quot;                              
##  [3] &quot;divine secrets of the ya-ya sisterhood: a novel&quot;
##  [4] &quot;angels &amp;amp; demons&quot;                            
##  [5] &quot;the firm&quot;                                       
##  [6] &quot;house of sand and fog&quot;                          
##  [7] &quot;the secret life of bees&quot;                        
##  [8] &quot;snow falling on cedars&quot;                         
##  [9] &quot;the bridges of madison county&quot;                  
## [10] &quot;summer sisters&quot;                                 
## [11] &quot;good in bed&quot;
</code></pre>
<p>###Matrix factorisation### This is used to check the accuracy of the suggested ratings for books that was not rated.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb20-1" data-line-number="1">read_books_fac &lt;-<span class="st"> </span>ratings_user <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb20-2" data-line-number="2"><span class="st">  </span><span class="kw">select</span>(User.ID, Book.Title, Book.Rating)<span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb20-3" data-line-number="3"><span class="st">  </span><span class="kw">spread</span>(<span class="dt">key =</span> Book.Title, <span class="dt">value =</span> Book.Rating)<span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb20-4" data-line-number="4"><span class="st"> </span><span class="kw">mutate_all</span>(<span class="kw">funs</span>(<span class="kw">replace</span>(.,<span class="kw">is.na</span>(.),<span class="dv">0</span>)))</a>
<a class="sourceLine" id="cb20-5" data-line-number="5"></a>
<a class="sourceLine" id="cb20-6" data-line-number="6">read_books_fac&lt;-<span class="st"> </span><span class="kw">as.matrix</span>(read_books_fac[,<span class="op">!</span>(<span class="kw">names</span>(read_books_fac) <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;User.ID&quot;</span>))])</a>
<a class="sourceLine" id="cb20-7" data-line-number="7"></a>
<a class="sourceLine" id="cb20-8" data-line-number="8"><span class="kw">set.seed</span>(<span class="dv">123</span>)</a>
<a class="sourceLine" id="cb20-9" data-line-number="9"></a>
<a class="sourceLine" id="cb20-10" data-line-number="10">k &lt;-<span class="dv">35</span>;</a>
<a class="sourceLine" id="cb20-11" data-line-number="11">init &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">W =</span> <span class="kw">matrix</span>(<span class="kw">runif</span>(<span class="kw">nrow</span>(read_books_fac)<span class="op">*</span>k), <span class="dt">ncol =</span> k),</a>
<a class="sourceLine" id="cb20-12" data-line-number="12">    <span class="dt">H =</span> <span class="kw">matrix</span>(<span class="kw">runif</span>(<span class="kw">ncol</span>(read_books_fac)<span class="op">*</span>k), <span class="dt">nrow =</span> k))</a>
<a class="sourceLine" id="cb20-13" data-line-number="13"></a>
<a class="sourceLine" id="cb20-14" data-line-number="14"><span class="kw">nnmf</span>(read_books_fac,k, <span class="dt">init =</span> init, <span class="dt">max.iter =</span> <span class="dv">10000</span>,<span class="dt">method =</span> <span class="st">'scd'</span>,<span class="dt">loss =</span> <span class="st">'mkl'</span>)</a></code></pre></div>
<pre><code>## Non-negative matrix factorization:
##    Algorithm: Sequential coordinate-wise descent
##         Loss: Mean Kullback-Leibler divergence
##          MSE: 0.6245891
##          MKL: 0.1679827
##       Target: 0.1679827
##    Rel. tol.: 2.31e-15
## Total epochs: 201
## # Interation: 201
## Running time:
##    user  system elapsed 
## 195.126   0.801 196.457
</code></pre>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb22-1" data-line-number="1">predicted_ratings &lt;-<span class="st"> </span>init[[<span class="st">'W'</span>]] <span class="op">%*%</span><span class="st"> </span>init[[<span class="st">'H'</span>]]</a>
<a class="sourceLine" id="cb22-2" data-line-number="2">matrix_fac&lt;-<span class="kw">as.matrix</span>(<span class="kw">rbind</span>(<span class="kw">round</span>(predicted_ratings[<span class="dv">1</span>,], <span class="dv">1</span>), <span class="kw">as.numeric</span>(read_books_fac[<span class="dv">15</span>,])))</a>
<a class="sourceLine" id="cb22-3" data-line-number="3">matrix_fac</a></code></pre></div>
<pre><code>##      [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8] [,9] [,10] [,11] [,12] [,13]
## [1,]  9.8  7.9  8.6  7.5  9.5 10.7  9.2  8.8  9.2   9.3   9.4   9.7     8
## [2,]  0.0  0.0  0.0  0.0  0.0  0.0  7.0  7.0  0.0   0.0   0.0   0.0     0
##      [,14] [,15] [,16] [,17] [,18] [,19] [,20] [,21] [,22] [,23] [,24]
## [1,]   7.9   9.7   9.6   7.4   8.7  10.3   8.7   8.9   8.4  10.1   8.2
## [2,]   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0
##      [,25] [,26] [,27] [,28] [,29] [,30] [,31] [,32] [,33] [,34] [,35]
## [1,]   8.3  10.3   8.3   9.3   8.3   8.7   8.5   7.8   8.6   9.2   8.8
## [2,]   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0
##      [,36] [,37] [,38] [,39] [,40] [,41] [,42] [,43] [,44] [,45] [,46]
## [1,]   7.7   8.7   8.5   9.7  11.1   9.3   8.3   8.4    11   8.7     8
## [2,]   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0     0   0.0     0
##      [,47] [,48] [,49] [,50] [,51] [,52] [,53] [,54] [,55] [,56] [,57]
## [1,]   9.6   9.4   9.5  11.4   8.3   9.8   8.8   7.9   8.9  10.3  10.6
## [2,]   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0
##      [,58] [,59] [,60] [,61] [,62] [,63] [,64] [,65] [,66] [,67] [,68]
## [1,]   8.5     9   8.5   9.8   7.4     9   8.5   9.8   9.6   9.4   8.6
## [2,]   0.0     0   0.0   9.0   0.0     0   0.0   0.0   0.0   0.0   0.0
##      [,69] [,70] [,71] [,72] [,73] [,74] [,75] [,76] [,77] [,78] [,79]
## [1,]   8.7   9.6   9.9   9.3   8.9   9.1   9.9   8.9   9.3   8.7     7
## [2,]   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0     0
##      [,80] [,81] [,82] [,83] [,84] [,85] [,86] [,87] [,88] [,89] [,90]
## [1,]   7.8   9.3   8.9     9   8.9   9.3   9.6   9.4  10.3  10.4   7.9
## [2,]   0.0   0.0   0.0     0   0.0   0.0   0.0   0.0   0.0  10.0   0.0
##      [,91] [,92] [,93] [,94] [,95] [,96] [,97] [,98] [,99] [,100] [,101]
## [1,]  10.8     9  10.3     9   9.7  11.5  10.5   8.2   8.4    9.6    9.5
## [2,]   0.0     0   0.0     0   0.0   0.0   0.0   0.0   0.0    0.0    0.0
##      [,102] [,103] [,104] [,105] [,106] [,107] [,108] [,109] [,110] [,111]
## [1,]    9.3    8.8   10.7    9.1    9.7    8.5    8.7    8.1    9.9    9.4
## [2,]    0.0    0.0    0.0    0.0    0.0    0.0    0.0    0.0    0.0    0.0
##      [,112] [,113] [,114] [,115] [,116] [,117] [,118] [,119] [,120] [,121]
## [1,]    9.3    9.2    8.6    8.9   10.2    9.6    8.5    9.5      9    7.8
## [2,]    0.0    0.0    0.0    0.0    0.0    0.0    0.0    0.0      0    9.0
##      [,122] [,123] [,124] [,125] [,126] [,127] [,128] [,129] [,130] [,131]
## [1,]   10.1    8.1    8.8    8.7   11.1    8.6   10.3    8.1    9.3    9.5
## [2,]    0.0    0.0    0.0    0.0    0.0    0.0    0.0    0.0    0.0    0.0
##      [,132] [,133] [,134] [,135] [,136] [,137] [,138] [,139] [,140] [,141]
## [1,]    9.6    8.8    8.8   10.2    8.1    8.8    8.5    9.5    9.5    8.9
## [2,]    0.0    0.0    0.0    0.0    0.0    0.0    0.0    0.0    0.0    0.0
##      [,142] [,143] [,144] [,145] [,146] [,147] [,148] [,149]
## [1,]   10.4    7.7    8.2    7.1   10.4    7.4   10.1    9.8
## [2,]    0.0    0.0    0.0    0.0    0.0    0.0    0.0    0.0
</code></pre>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb24-1" data-line-number="1">predicted_ratings&lt;-<span class="kw">as.matrix</span>(predicted_ratings)</a>
<a class="sourceLine" id="cb24-2" data-line-number="2"><span class="kw">colnames</span>(predicted_ratings)&lt;-<span class="kw">colnames</span>(read_books)</a>
<a class="sourceLine" id="cb24-3" data-line-number="3"><span class="kw">rownames</span>(predicted_ratings)&lt;-<span class="kw">rownames</span>(read_books)</a></code></pre></div>
<p>The nect chunk of code it to use the matrix factorization to recommend books to a chosen user.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb25-1" data-line-number="1">data&lt;-predicted_ratings</a>
<a class="sourceLine" id="cb25-2" data-line-number="2">criteria &lt;-<span class="st"> </span><span class="dv">13</span></a>
<a class="sourceLine" id="cb25-3" data-line-number="3"> cosine_sim &lt;-<span class="st"> </span><span class="cf">function</span>(a, b){<span class="kw">crossprod</span>(a, b) <span class="op">/</span><span class="st"> </span><span class="kw">sqrt</span>(<span class="kw">crossprod</span>(a) <span class="op">*</span><span class="st"> </span><span class="kw">crossprod</span>(b))} <span class="co">#function to calculate similarity</span></a>
<a class="sourceLine" id="cb25-4" data-line-number="4">    item_similarities_fac =<span class="st"> </span><span class="kw">matrix</span>(<span class="dv">0</span>, <span class="dt">nrow=</span><span class="kw">ncol</span>(data),<span class="dt">ncol=</span><span class="kw">ncol</span>(data)) <span class="co">#create blank place holder matrix</span></a>
<a class="sourceLine" id="cb25-5" data-line-number="5">     item_matrice_fac&lt;-<span class="kw">matrix</span>(<span class="kw">rep</span>(data[,criteria],<span class="dt">times=</span><span class="kw">ncol</span>(data) ),<span class="dt">ncol =</span> <span class="kw">ncol</span>(data),<span class="dt">nrow =</span> <span class="kw">nrow</span>(data),<span class="dt">byrow =</span> <span class="ot">TRUE</span>) <span class="co">#fil matrix with one item ratings</span></a>
<a class="sourceLine" id="cb25-6" data-line-number="6">     item_similarities_fac &lt;-<span class="st"> </span><span class="kw">cosine_sim</span>(item_matrice_fac,data) <span class="co">#calculate the similarities between user matrix and the rest of the database ratings</span></a>
<a class="sourceLine" id="cb25-7" data-line-number="7">     item_similarities_fac&lt;-<span class="kw">as.matrix</span>(<span class="kw">diag</span>(item_similarities_fac)) <span class="co">#the diagonal values of matrix is the similarity bewteen chosen item and rest of the items</span></a>
<a class="sourceLine" id="cb25-8" data-line-number="8"></a>
<a class="sourceLine" id="cb25-9" data-line-number="9">     <span class="kw">colnames</span>(item_similarities_fac) &lt;-<span class="st"> 'user score'</span> <span class="co">#column name of the similarity vecetor</span></a>
<a class="sourceLine" id="cb25-10" data-line-number="10">     <span class="kw">rownames</span>(item_similarities_fac) &lt;-<span class="st"> </span><span class="kw">colnames</span>(data) <span class="co">#row names of the similarity vector</span></a>
<a class="sourceLine" id="cb25-11" data-line-number="11"></a>
<a class="sourceLine" id="cb25-12" data-line-number="12">  item_similarities_fac&lt;-<span class="kw">as.data.frame</span>(item_similarities_fac)</a>
<a class="sourceLine" id="cb25-13" data-line-number="13">   item_similarities_fac<span class="op">%&gt;%</span><span class="kw">mutate</span>(<span class="dt">title =</span><span class="kw">colnames</span>(data))<span class="op">%&gt;%</span><span class="st"> </span><span class="kw">arrange</span>(<span class="kw">desc</span>(item_similarities_fac<span class="op">$</span><span class="st">`</span><span class="dt">user score</span><span class="st">`</span>)) <span class="op">%&gt;%</span><span class="kw">head</span>(<span class="dv">10</span>) <span class="op">%&gt;%</span><span class="kw">head</span>(<span class="dv">10</span>)</a></code></pre></div>
<pre><code>##    user score                                                    title
## 1   0.9876023                                    house of sand and fog
## 2   0.9875452   a is for alibi (kinsey millhone mysteries (paperback))
## 3   0.9874854               full house (janet evanovich's full series)
## 4   0.9874606 confessions of a shopaholic (summer display opportunity)
## 5   0.9874435                                          the beach house
## 6   0.9873553                                    bridget jones's diary
## 7   0.9873545                                 white oleander : a novel
## 8   0.9873487                                              wild animus
## 9   0.9873422                                               the reader
## 10  0.9873378                    she's come undone (oprah's book club)
</code></pre>
<p>Code for function recommender which is saved in seperate .R file.</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb27-1" data-line-number="1"><span class="co">#' Recommender for books</span></a>
<a class="sourceLine" id="cb27-2" data-line-number="2"><span class="co">#'The package recommends a list of books according to user, or item.</span></a>
<a class="sourceLine" id="cb27-3" data-line-number="3"><span class="co">#' @param data database of book and user ratings</span></a>
<a class="sourceLine" id="cb27-4" data-line-number="4"><span class="co">#' @param criteria user wanting the recommended books</span></a>
<a class="sourceLine" id="cb27-5" data-line-number="5"><span class="co">#' @param typetype of recommeder system</span></a>
<a class="sourceLine" id="cb27-6" data-line-number="6"><span class="co">#'</span></a>
<a class="sourceLine" id="cb27-7" data-line-number="7"><span class="co">#' @return the top 10 books like to be liked by user.</span></a>
<a class="sourceLine" id="cb27-8" data-line-number="8"><span class="co">#' @export</span></a>
<a class="sourceLine" id="cb27-9" data-line-number="9"><span class="co">#'</span></a>
<a class="sourceLine" id="cb27-10" data-line-number="10"><span class="co">#' @examples</span></a>
<a class="sourceLine" id="cb27-11" data-line-number="11"><span class="co">#' recommend(book_ratings, 13, type = 'item')</span></a>
<a class="sourceLine" id="cb27-12" data-line-number="12"><span class="co">#' recommend(book_ratings, 23, type = 'user')</span></a>
<a class="sourceLine" id="cb27-13" data-line-number="13">recommend&lt;-<span class="st"> </span><span class="cf">function</span>(data,criteria,<span class="dt">type =</span> <span class="st">''</span>, <span class="dt">raw_data =</span> <span class="ot">NULL</span>){</a>
<a class="sourceLine" id="cb27-14" data-line-number="14"></a>
<a class="sourceLine" id="cb27-15" data-line-number="15">  cosine_sim &lt;-<span class="st"> </span><span class="cf">function</span>(a, b){<span class="kw">crossprod</span>(a, b) <span class="op">/</span><span class="st"> </span><span class="kw">sqrt</span>(<span class="kw">crossprod</span>(a) <span class="op">*</span><span class="st"> </span><span class="kw">crossprod</span>(b))} <span class="co">#function to calculate similarity</span></a>
<a class="sourceLine" id="cb27-16" data-line-number="16"></a>
<a class="sourceLine" id="cb27-17" data-line-number="17"><span class="co">#if the type of similarity is item</span></a>
<a class="sourceLine" id="cb27-18" data-line-number="18">   <span class="cf">if</span>(type <span class="op">==</span><span class="st"> 'item'</span>)</a>
<a class="sourceLine" id="cb27-19" data-line-number="19">     {</a>
<a class="sourceLine" id="cb27-20" data-line-number="20"></a>
<a class="sourceLine" id="cb27-21" data-line-number="21">     item_similarities =<span class="st"> </span><span class="kw">matrix</span>(<span class="dv">0</span>, <span class="dt">nrow=</span><span class="kw">ncol</span>(data),<span class="dt">ncol=</span><span class="kw">ncol</span>(data)) <span class="co">#create blank place holder matrix</span></a>
<a class="sourceLine" id="cb27-22" data-line-number="22">     item_matrice&lt;-<span class="kw">matrix</span>(<span class="kw">rep</span>(data[,criteria],<span class="dt">times=</span><span class="kw">ncol</span>(data) ),<span class="dt">ncol =</span> <span class="kw">ncol</span>(data),<span class="dt">nrow =</span> <span class="kw">nrow</span>(data),<span class="dt">byrow =</span> <span class="ot">TRUE</span>) <span class="co">#fil matrix with one item ratings</span></a>
<a class="sourceLine" id="cb27-23" data-line-number="23">     item_similarities &lt;-<span class="st"> </span><span class="kw">cosine_sim</span>(item_matrice,data) <span class="co">#calculate the similarities between user matrix and the rest of the database ratings</span></a>
<a class="sourceLine" id="cb27-24" data-line-number="24">     item_similarities&lt;-<span class="kw">as.matrix</span>(<span class="kw">diag</span>(item_similarities)) <span class="co">#the diagonal values of matrix is the similarity bewteen chosen item and rest of the items</span></a>
<a class="sourceLine" id="cb27-25" data-line-number="25"></a>
<a class="sourceLine" id="cb27-26" data-line-number="26">     <span class="kw">colnames</span>(item_similarities) &lt;-<span class="st"> 'user score'</span> <span class="co">#column name of the similarity vecetor</span></a>
<a class="sourceLine" id="cb27-27" data-line-number="27">     <span class="kw">rownames</span>(item_similarities) &lt;-<span class="st"> </span><span class="kw">colnames</span>(data) <span class="co">#row names of the similarity vector</span></a>
<a class="sourceLine" id="cb27-28" data-line-number="28"></a>
<a class="sourceLine" id="cb27-29" data-line-number="29">     user_seen &lt;-<span class="st"> </span><span class="kw">row.names</span>(item_similarities)[data[criteria,] <span class="op">==</span><span class="st"> </span><span class="ot">TRUE</span>] <span class="co">#get the movie the chosen user has seen</span></a>
<a class="sourceLine" id="cb27-30" data-line-number="30"></a>
<a class="sourceLine" id="cb27-31" data-line-number="31">     item_seen&lt;-<span class="kw">unlist</span>(item_similarities[user_seen,])</a>
<a class="sourceLine" id="cb27-32" data-line-number="32">     item_similarities&lt;-<span class="kw">as.data.frame</span>(item_similarities)</a>
<a class="sourceLine" id="cb27-33" data-line-number="33">    <span class="co">#create a data frame with user scores and if the user has seen the movie</span></a>
<a class="sourceLine" id="cb27-34" data-line-number="34">     item_score&lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">title =</span> <span class="kw">colnames</span>(data),</a>
<a class="sourceLine" id="cb27-35" data-line-number="35">                             <span class="dt">score =</span> item_similarities<span class="op">$</span><span class="st">`</span><span class="dt">user score</span><span class="st">`</span>,</a>
<a class="sourceLine" id="cb27-36" data-line-number="36">                             <span class="dt">seen =</span> <span class="kw">ifelse</span>(item_seen<span class="op">==</span>item_similarities[,<span class="dv">1</span>],<span class="dv">1</span>,<span class="dv">0</span>))</a>
<a class="sourceLine" id="cb27-37" data-line-number="37">    <span class="co">#recommend top 10 similar movies the user has not seen</span></a>
<a class="sourceLine" id="cb27-38" data-line-number="38">    recommend&lt;-<span class="st"> </span>item_score <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(seen <span class="op">==</span><span class="st"> </span><span class="dv">0</span>) <span class="op">%&gt;%</span><span class="kw">arrange</span>(<span class="kw">desc</span>(score)) <span class="op">%&gt;%</span><span class="kw">select</span>(<span class="op">-</span>seen)<span class="op">%&gt;%</span><span class="st"> </span><span class="kw">head</span>(<span class="dv">10</span>)</a>
<a class="sourceLine" id="cb27-39" data-line-number="39"></a>
<a class="sourceLine" id="cb27-40" data-line-number="40"></a>
<a class="sourceLine" id="cb27-41" data-line-number="41"></a>
<a class="sourceLine" id="cb27-42" data-line-number="42"></a>
<a class="sourceLine" id="cb27-43" data-line-number="43">   }</a>
<a class="sourceLine" id="cb27-44" data-line-number="44">  <span class="co">#if the chosen type is user</span></a>
<a class="sourceLine" id="cb27-45" data-line-number="45">  <span class="cf">if</span>(type <span class="op">==</span><span class="st"> 'user'</span>){</a>
<a class="sourceLine" id="cb27-46" data-line-number="46">    user_similarities =<span class="st"> </span><span class="kw">matrix</span>(<span class="dv">0</span>, <span class="dt">nrow=</span><span class="kw">nrow</span>(data),<span class="dt">ncol=</span><span class="kw">nrow</span>(data)) <span class="co">#create blank holder matrix</span></a>
<a class="sourceLine" id="cb27-47" data-line-number="47"></a>
<a class="sourceLine" id="cb27-48" data-line-number="48">    user_matrice&lt;-<span class="kw">matrix</span>(<span class="kw">rep</span>(data[criteria,],<span class="dt">times=</span><span class="kw">nrow</span>(data) ),<span class="dt">ncol =</span> <span class="kw">nrow</span>(data),<span class="dt">nrow =</span> <span class="kw">ncol</span>(data),<span class="dt">byrow =</span> <span class="ot">TRUE</span>) <span class="co">#fill matrix with one user rating</span></a>
<a class="sourceLine" id="cb27-49" data-line-number="49">    user_similarities &lt;-<span class="st"> </span><span class="kw">cosine_sim</span>(user_matrice,<span class="kw">t</span>(data)) <span class="co">#calculate the similarities between the user and the rest of the user ratings</span></a>
<a class="sourceLine" id="cb27-50" data-line-number="50">    user_similarities&lt;-<span class="kw">as.matrix</span>(<span class="kw">diag</span>(user_similarities)) <span class="co">#diagonal values are the calcualted similarities between users</span></a>
<a class="sourceLine" id="cb27-51" data-line-number="51"></a>
<a class="sourceLine" id="cb27-52" data-line-number="52">    <span class="kw">colnames</span>(user_similarities) &lt;-<span class="st"> 'user score'</span></a>
<a class="sourceLine" id="cb27-53" data-line-number="53">    <span class="kw">rownames</span>(user_similarities) &lt;-<span class="st"> </span><span class="kw">rownames</span>(data)</a>
<a class="sourceLine" id="cb27-54" data-line-number="54"></a>
<a class="sourceLine" id="cb27-55" data-line-number="55">    user_seenit &lt;-<span class="st"> </span><span class="kw">row.names</span>(user_similarities)[data[,criteria] <span class="op">==</span><span class="st"> </span><span class="ot">TRUE</span>] <span class="co">#get the movie the chosen user has seen</span></a>
<a class="sourceLine" id="cb27-56" data-line-number="56"></a>
<a class="sourceLine" id="cb27-57" data-line-number="57">    user_seent&lt;-<span class="kw">unlist</span>(user_similarities[user_seenit,])</a>
<a class="sourceLine" id="cb27-58" data-line-number="58">    user_similarities&lt;-<span class="kw">as.data.frame</span>(user_similarities)</a>
<a class="sourceLine" id="cb27-59" data-line-number="59"></a>
<a class="sourceLine" id="cb27-60" data-line-number="60">    user_score&lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">title =</span> sorted_my_users,</a>
<a class="sourceLine" id="cb27-61" data-line-number="61">                            <span class="dt">score =</span>(user_similarities<span class="op">$</span><span class="st">`</span><span class="dt">user score</span><span class="st">`</span>))</a>
<a class="sourceLine" id="cb27-62" data-line-number="62"></a>
<a class="sourceLine" id="cb27-63" data-line-number="63"><span class="co">#eliminate user has seen- not entirely correct but will work</span></a>
<a class="sourceLine" id="cb27-64" data-line-number="64">    user_scored&lt;-<span class="st">  </span>user_score <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb27-65" data-line-number="65"><span class="st">      </span><span class="kw">filter</span>(score <span class="op">!=</span><span class="st"> </span><span class="dv">1</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb27-66" data-line-number="66"><span class="st">      </span><span class="kw">arrange</span>(<span class="kw">desc</span>(score))</a>
<a class="sourceLine" id="cb27-67" data-line-number="67"></a>
<a class="sourceLine" id="cb27-68" data-line-number="68">    last&lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(user_scored<span class="op">%&gt;%</span><span class="kw">head</span>(<span class="dv">10</span>)<span class="op">%&gt;%</span><span class="kw">select</span>(title))</a>
<a class="sourceLine" id="cb27-69" data-line-number="69"></a>
<a class="sourceLine" id="cb27-70" data-line-number="70">    <span class="kw">colnames</span>(last)&lt;-<span class="st">'User.ID'</span></a>
<a class="sourceLine" id="cb27-71" data-line-number="71">    last&lt;-<span class="kw">as_data_frame</span>(last)</a>
<a class="sourceLine" id="cb27-72" data-line-number="72">    lasted&lt;-<span class="kw">merge</span>(raw_data,last,<span class="dt">by =</span> <span class="st">'User.ID'</span>)<span class="co">#create table of the movies and similar users</span></a>
<a class="sourceLine" id="cb27-73" data-line-number="73">    lasted&lt;-<span class="st"> </span><span class="kw">apply</span>(lasted, <span class="dv">1</span>, <span class="cf">function</span>(i) <span class="kw">paste</span>(<span class="kw">names</span>(i[i <span class="op">!=</span><span class="st"> </span><span class="dv">0</span> ]))) <span class="co">#keep movies only which was rated</span></a>
<a class="sourceLine" id="cb27-74" data-line-number="74">    lasted&lt;-<span class="kw">as.matrix</span>(lasted) <span class="co">#create as matrix</span></a>
<a class="sourceLine" id="cb27-75" data-line-number="75">    lasted&lt;-<span class="st"> </span><span class="kw">as.matrix</span>(lasted[<span class="op">-</span><span class="dv">1</span>,]) <span class="co">#remove user.id column</span></a>
<a class="sourceLine" id="cb27-76" data-line-number="76"><span class="co">#recommend the movies as user similarities</span></a>
<a class="sourceLine" id="cb27-77" data-line-number="77">    recommend&lt;-lasted[<span class="op">!</span><span class="kw">duplicated</span>(lasted[])]<span class="op">%&gt;%</span><span class="kw">head</span>(<span class="dv">10</span>)</a>
<a class="sourceLine" id="cb27-78" data-line-number="78"></a>
<a class="sourceLine" id="cb27-79" data-line-number="79">  }</a>
<a class="sourceLine" id="cb27-80" data-line-number="80">  <span class="co">#if type is k-nearest</span></a>
<a class="sourceLine" id="cb27-81" data-line-number="81">  <span class="cf">if</span>(type <span class="op">==</span><span class="st"> 'item2'</span>){</a>
<a class="sourceLine" id="cb27-82" data-line-number="82"></a>
<a class="sourceLine" id="cb27-83" data-line-number="83"></a>
<a class="sourceLine" id="cb27-84" data-line-number="84">  cosineSim &lt;-<span class="st"> </span><span class="cf">function</span>(matrix1,matrix2) {</a>
<a class="sourceLine" id="cb27-85" data-line-number="85"></a>
<a class="sourceLine" id="cb27-86" data-line-number="86">    <span class="kw">apply</span>(matrix1,<span class="dv">2</span>,<span class="cf">function</span>(x){</a>
<a class="sourceLine" id="cb27-87" data-line-number="87"></a>
<a class="sourceLine" id="cb27-88" data-line-number="88">      <span class="kw">apply</span>(matrix2,<span class="dv">2</span>,cosine_sim,x)</a>
<a class="sourceLine" id="cb27-89" data-line-number="89">    })</a>
<a class="sourceLine" id="cb27-90" data-line-number="90">  }</a>
<a class="sourceLine" id="cb27-91" data-line-number="91"></a>
<a class="sourceLine" id="cb27-92" data-line-number="92"></a>
<a class="sourceLine" id="cb27-93" data-line-number="93">  sim_num&lt;-<span class="kw">crossprod</span>(read_books)</a>
<a class="sourceLine" id="cb27-94" data-line-number="94">  diagnl&lt;-<span class="kw">sqrt</span>(<span class="kw">diag</span>(sim_num))</a>
<a class="sourceLine" id="cb27-95" data-line-number="95">  sim_dem&lt;-diagnl<span class="op">%*%</span><span class="kw">t</span>(diagnl)</a>
<a class="sourceLine" id="cb27-96" data-line-number="96">  similarity&lt;-sim_num<span class="op">/</span>sim_dem</a>
<a class="sourceLine" id="cb27-97" data-line-number="97">  similarity&lt;-<span class="kw">as.data.frame</span>(similarity)</a>
<a class="sourceLine" id="cb27-98" data-line-number="98"></a>
<a class="sourceLine" id="cb27-99" data-line-number="99">  similarity[<span class="dv">1</span><span class="op">:</span><span class="dv">6</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">4</span>]</a>
<a class="sourceLine" id="cb27-100" data-line-number="100"></a>
<a class="sourceLine" id="cb27-101" data-line-number="101">  <span class="kw">diag</span>(similarity)&lt;-<span class="dv">0</span></a>
<a class="sourceLine" id="cb27-102" data-line-number="102">  sim_neighbours =<span class="st"> </span><span class="kw">matrix</span>(<span class="ot">NA</span>, <span class="dt">nrow=</span><span class="kw">ncol</span>(similarity),<span class="dt">ncol=</span><span class="dv">11</span>,<span class="dt">dimnames=</span><span class="kw">list</span>(<span class="kw">colnames</span>(similarity)))</a>
<a class="sourceLine" id="cb27-103" data-line-number="103"></a>
<a class="sourceLine" id="cb27-104" data-line-number="104">  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">ncol</span>(read_books)) { <span class="co"># loop through songs</span></a>
<a class="sourceLine" id="cb27-105" data-line-number="105">    sim_neighbours[i,] &lt;-<span class="st"> </span>(<span class="kw">t</span>(<span class="kw">head</span>(<span class="dt">n=</span><span class="dv">11</span>,<span class="kw">rownames</span>(similarity[<span class="kw">order</span>(similarity[,i],<span class="dt">decreasing=</span><span class="ot">TRUE</span>),][i]))))</a>
<a class="sourceLine" id="cb27-106" data-line-number="106">  }</a>
<a class="sourceLine" id="cb27-107" data-line-number="107"></a>
<a class="sourceLine" id="cb27-108" data-line-number="108"></a>
<a class="sourceLine" id="cb27-109" data-line-number="109">  recommend&lt;-sim_neighbours[<span class="dv">149</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">11</span>]</a>
<a class="sourceLine" id="cb27-110" data-line-number="110">}</a>
<a class="sourceLine" id="cb27-111" data-line-number="111">    <span class="kw">return</span>(recommend)</a>
<a class="sourceLine" id="cb27-112" data-line-number="112"></a>
<a class="sourceLine" id="cb27-113" data-line-number="113">  <span class="cf">if</span>(type <span class="op">==</span><span class="st"> ''</span>){</a>
<a class="sourceLine" id="cb27-114" data-line-number="114">    <span class="kw">print</span>(<span class="st">'No type selected'</span>)</a>
<a class="sourceLine" id="cb27-115" data-line-number="115">  }</a>
<a class="sourceLine" id="cb27-116" data-line-number="116"></a>
<a class="sourceLine" id="cb27-117" data-line-number="117"></a>
<a class="sourceLine" id="cb27-118" data-line-number="118"></a>
<a class="sourceLine" id="cb27-119" data-line-number="119">}</a></code></pre></div>

</body>
</html>
